"use strict";(self["webpackChunkvue3_2022_spring"]=self["webpackChunkvue3_2022_spring"]||[]).push([[433],{9433:function(t,e,o){o.r(e),o.d(e,{default:function(){return ft}});var a=o(6252),l=o(3577);const n={class:"d-flex align-items-center justify-content-between"},s=(0,a._)("h1",{class:"mb-0"},"後台優惠券列表",-1),d={class:"row"},i={class:"col"},c={class:"table-responsive py-2"},m={class:"table text-center align-middle"},u=(0,a._)("thead",{class:"table-light"},[(0,a._)("tr",null,[(0,a._)("th",{width:"6%",scope:"col"},"#"),(0,a._)("th",{width:"12%",scope:"col"},"優惠券標題"),(0,a._)("th",{width:"12%",scope:"col"},"優惠碼"),(0,a._)("th",{width:"12%",scope:"col"},"折扣"),(0,a._)("th",{width:"12%",scope:"col"},"起始日"),(0,a._)("th",{width:"12%",scope:"col"},"截止日"),(0,a._)("th",{width:"12%",scope:"col"},"啟用"),(0,a._)("th",{width:"22%",scope:"col"},"編輯")])],-1),p={class:"form-check form-switch float-none d-inline-block mb-0"},r=["onClick"],h=["onClick"],b=["onClick"],_=(0,a.Uk)(" 是否刪除 "),g={class:"text-danger"},f=(0,a.Uk)("優惠券"),v=(0,a._)("br",null,null,-1),w=(0,a.Uk)(" 提醒您，刪除後將無法恢復 ");function y(t,e,o,y,k,C){const M=(0,a.up)("pagination-nav"),D=(0,a.up)("CouponModal"),$=(0,a.up)("SuccessModal"),x=(0,a.up)("DeleteModal");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a._)("div",n,[s,(0,a._)("button",{class:"btn btn-sm btn-primary",type:"button",onClick:e[0]||(e[0]=e=>{k.modal.title="建立新優惠券",C.openCouponModal(k.modal.title,t.coupon)})}," 建立新優惠券 ")]),(0,a._)("div",d,[(0,a._)("div",i,[(0,a._)("div",c,[(0,a._)("table",m,[u,(0,a._)("tbody",null,[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(k.coupons,((t,e)=>((0,a.wg)(),(0,a.iD)("tr",{key:t.id},[(0,a._)("td",null,(0,l.zw)(e+1),1),(0,a._)("td",null,(0,l.zw)(t.title),1),(0,a._)("td",null,(0,l.zw)(t.code),1),(0,a._)("td",null,(0,l.zw)(t.percent),1),(0,a._)("td",null,(0,l.zw)(C.toDate(t.start_date/1e3)),1),(0,a._)("td",null,(0,l.zw)(C.toDate(t.due_date/1e3)),1),(0,a._)("td",null,[(0,a._)("div",p,[(0,a._)("button",{class:(0,l.C_)(["form-check-input",{checked:1==t.is_enabled}]),onClick:e=>{C.toggleEnabled(t)}},null,10,r)])]),(0,a._)("td",null,[(0,a._)("button",{class:"btn btn-sm btn-primary me-1",type:"button",onClick:e=>{k.modal.title="編輯優惠券",C.openCouponModal(k.modal.title,t)}}," 編輯 ",8,h),(0,a._)("button",{class:"btn btn-sm btn-outline-danger",type:"button",onClick:e=>{k.modal.title="刪除優惠券",C.openCouponModal(k.modal.title,t)}}," 刪除 ",8,b)])])))),128))])])])])]),(0,a.Wm)(M,{pages:k.paginations,onGetDatas:t.getProduct},null,8,["pages","onGetDatas"]),(0,a.Wm)(D,{modal:k.modal.temp,type:k.modal.title,onEmitCouponData:C.updateCoupon},{title:(0,a.w5)((()=>[(0,a.Uk)((0,l.zw)(k.modal.title),1)])),_:1},8,["modal","type","onEmitCouponData"]),(0,a.Wm)($,null,{title:(0,a.w5)((()=>[(0,a.Uk)((0,l.zw)(k.modal.title),1)])),default:(0,a.w5)((()=>[(0,a.Uk)((0,l.zw)(k.modal.content),1)])),_:1}),(0,a.Wm)(x,{modal:k.modal.temp,onEmitDelete:C.deleteCoupon},{title:(0,a.w5)((()=>[(0,a.Uk)((0,l.zw)(k.modal.title),1)])),default:(0,a.w5)((()=>[_,(0,a._)("b",g,(0,l.zw)(k.modal.temp.title),1),f,v,w])),_:1},8,["modal","onEmitDelete"])],64)}var k=o(4983),C=o(9963);const M={class:"modal-dialog modal-lg modal-dialog-centered"},D={class:"modal-content"},$={class:"modal-body p-3"},x={class:"mb-2"},U={class:"row"},V={class:"col-md-4 mb-2"},z={class:"form-floating"},S=(0,a._)("label",{for:"floatingTitle"},"請輸入優惠券標題",-1),E={class:"col-md-5 mb-2"},j={class:"row align-items-end"},W={class:"col-8 pe-1"},P={class:"form-floating"},T=(0,a._)("label",{for:"floatingCode"},"請輸入優惠碼",-1),Z={class:"col-4 ps-0"},G={class:"col-md-3 mb-2"},H={class:"form-floating"},J=(0,a._)("label",{for:"floatingPercent"},"請輸入折扣 (%)",-1),N={class:"col-md-12 mb-2"},Y={class:"row align-items-center"},I={class:"col"},K=(0,a._)("label",{for:"startDate",class:"visually-hidden"},"請選擇起始日",-1),L={class:"input-group"},O=["value"],Q=["onClick"],A=(0,a._)("span",{class:"material-icons-outlined d-block fs-6"},"calendar_today",-1),B=[A],F=(0,a._)("div",{class:"col-auto"},"～",-1),R={class:"col"},X=(0,a._)("label",{for:"startDate",class:"visually-hidden"},"請選擇截止日",-1),q={class:"input-group"},tt=["value"],et=["onClick"],ot=(0,a._)("span",{class:"material-icons-outlined d-block fs-6"},"calendar_today",-1),at=[ot],lt={class:"col-md-12 mb-2"},nt={class:"form-check"},st=(0,a._)("label",{class:"form-check-label",for:"checkEnable"}," 是否啟用 ",-1),dt={class:"d-flex align-items-center justify-content-end mt-2"},it=(0,a._)("button",{type:"button",class:"btn btn-outline-secondary me-1","data-bs-dismiss":"modal"}," 取消 ",-1);function ct(t,e,o,l,n,s){const d=(0,a.up)("v-date-picker");return(0,a.wg)(),(0,a.iD)("form",{class:"modal fade needs-validation",id:"couponModal","data-bs-backdrop":"static","data-bs-keyboard":"false",novalidate:"",onSubmit:e[8]||(e[8]=(0,C.iM)((()=>{}),["prevent"]))},[(0,a._)("div",M,[(0,a._)("div",D,[(0,a._)("div",$,[(0,a._)("h2",x,[(0,a.WI)(t.$slots,"title")]),(0,a._)("div",U,[(0,a._)("div",V,[(0,a._)("div",z,[(0,a.wy)((0,a._)("input",{type:"text",class:"form-control border-0 border-bottom border-secondary",id:"floatingTitle",placeholder:"請輸入優惠券標題","onUpdate:modelValue":e[0]||(e[0]=t=>n.data.title=t)},null,512),[[C.nr,n.data.title]]),S])]),(0,a._)("div",E,[(0,a._)("div",j,[(0,a._)("div",W,[(0,a._)("div",P,[(0,a.wy)((0,a._)("input",{type:"text",class:"form-control border-0 border-bottom border-secondary",id:"floatingCode",placeholder:"請輸入優惠碼","onUpdate:modelValue":e[1]||(e[1]=t=>n.data.code=t)},null,512),[[C.nr,n.data.code]]),T])]),(0,a._)("div",Z,[(0,a._)("button",{type:"button",class:"btn btn-sm btn-outline-secondary",onClick:e[2]||(e[2]=t=>s.randomCoupon(6))},"產生")])])]),(0,a._)("div",G,[(0,a._)("div",H,[(0,a.wy)((0,a._)("input",{type:"number",min:"0",max:"100",class:"form-control border-0 border-bottom border-secondary",id:"floatingPercent",placeholder:"請輸入折扣 (%)","onUpdate:modelValue":e[3]||(e[3]=t=>n.data.percent=t)},null,512),[[C.nr,n.data.percent]]),J])]),(0,a._)("div",N,[(0,a._)("div",Y,[(0,a._)("div",I,[K,(0,a.Wm)(d,{color:"indigo",class:"inline-block h-full",modelValue:n.data.start_date,"onUpdate:modelValue":e[4]||(e[4]=t=>n.data.start_date=t),"model-config":n.modelConfig},{default:(0,a.w5)((({inputValue:t,togglePopover:e})=>[(0,a._)("div",L,[(0,a._)("input",{class:"form-control",id:"start-date",value:t,placeholder:"請選擇起始日"},null,8,O),(0,a._)("button",{class:"btn btn-sm btn-outline-secondary",onClick:t=>e()},B,8,Q)])])),_:1},8,["modelValue","model-config"])]),F,(0,a._)("div",R,[X,(0,a.Wm)(d,{color:"indigo",class:"inline-block h-full",modelValue:n.data.due_date,"onUpdate:modelValue":e[5]||(e[5]=t=>n.data.due_date=t),"model-config":n.modelConfig},{default:(0,a.w5)((({inputValue:t,togglePopover:e})=>[(0,a._)("div",q,[(0,a._)("input",{class:"form-control",id:"end-date",value:t,placeholder:"請選擇截止日"},null,8,tt),(0,a._)("button",{class:"btn btn-sm btn-outline-secondary",onClick:t=>e()},at,8,et)])])),_:1},8,["modelValue","model-config"])])])]),(0,a._)("div",lt,[(0,a._)("div",nt,[(0,a.wy)((0,a._)("input",{class:"form-check-input",type:"checkbox",value:"is_enabled",id:"checkEnable","onUpdate:modelValue":e[6]||(e[6]=t=>n.data.is_enabled=t),"true-value":1,"false-value":0},null,512),[[C.e8,n.data.is_enabled,void 0,{number:!0}]]),st])])]),(0,a._)("div",dt,[it,(0,a._)("button",{type:"button",class:"btn btn-primary","data-bs-dismiss":"modal",onClick:e[7]||(e[7]=e=>t.$emit("emit-coupon-data",n.data))}," 儲存 ")])])])])],32)}var mt={data(){return{data:{},title:"",modelConfig:{type:"number"},today:new Date}},props:["modal","type"],emits:["emit-coupon-data"],methods:{randomCoupon(t){const e=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","m","n","p","Q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9"],o=e.length;let a="";for(let l=0;l<t;l+=1){const t=Math.floor(Math.random()*o);a+=e[t]}this.data.code=a}},watch:{modal(){this.data=this.modal,this.title=this.type}}},ut=o(3744);const pt=(0,ut.Z)(mt,[["render",ct]]);var rt=pt,ht=o(5146),bt=o(7393),_t={data(){return{coupons:[],bsModal:null,paginations:{},modal:{title:"",temp:{},content:""}}},components:{CouponModal:rt,SuccessModal:ht.Z,DeleteModal:bt.Z},mounted(){this.getCoupons()},methods:{getCoupons(){const t="https://vue3-course-api.hexschool.io/v2/api/ujhwang/admin/coupons";this.$http.get(t).then((t=>{this.$emitter.emit("page-loading",!1),this.coupons=t.data.coupons,this.paginations=t.data.pagination})).catch((t=>{this.$emitter.emit("page-loading",!1),console.log(t)}))},updateCoupon(t){this.$emitter.emit("page-loading",!0);const e=this.modal.title;let o="",a="";"建立新優惠券"===e?(o="https://vue3-course-api.hexschool.io/v2/api/ujhwang/admin/coupon",a="post"):"編輯優惠券"===e&&(o=`https://vue3-course-api.hexschool.io/v2/api/ujhwang/admin/coupon/${t.id}`,a="put");const l={data:t};""!==l.data.is_enabled&&void 0!==l.data.is_enabled||(l.data.is_enabled=0),this.$http[a](o,l).then((t=>{"建立新優惠券"===e?this.modal.title="新增成功":"編輯優惠券"===e&&(this.modal.title="修改成功"),this.modal.content=t.data.message,this.modal.temp={}})).catch((t=>{console.dir(t),"建立新優惠券"===e?this.modal.title="新增失敗":"編輯優惠券"===e&&(this.modal.title="修改失敗"),this.modal.content=t.response.data.message})).finally((()=>{this.getCoupons(),this.openSuccessModal()}))},deleteCoupon(t){this.$emitter.emit("page-loading",!0);const e=`https://vue3-course-api.hexschool.io/v2/api/ujhwang/admin/coupon/${t.id}`;this.$http.delete(e).then((t=>{this.modal.title="刪除成功",this.modal.content=t.data.message})).catch((t=>{this.modal.title="刪除失敗",this.modal.content=t.response.data.message})).finally((()=>{this.getCoupons(),this.clearTemp(),this.openSuccessModal()}))},toggleEnabled(t){const e=`https://vue3-course-api.hexschool.io/v2/api/ujhwang/admin/coupon/${t.id}`;this.$emitter.emit("page-loading",!0),this.modal.temp=t;const o={data:this.modal.temp};0===this.modal.temp.is_enabled||void 0===this.modal.temp.is_enabled?this.modal.temp.is_enabled=1:1===this.modal.temp.is_enabled&&(this.modal.temp.is_enabled=0),this.$http.put(e,o).then((t=>{this.modal.title="修改成功",this.modal.content=t.data.message,this.getCoupons()})).catch((t=>{console.dir(t),this.modal.title="修改失敗",this.modal.content=t.response.data.message})).finally((()=>{this.openSuccessModal(this.modal.title,this.modal.content)}))},openCouponModal(t,e){this.$emitter.emit("page-loading",!1),"編輯優惠券"===t?(this.bsModal=(0,k.$7)("couponModal"),this.modal.temp=JSON.parse(JSON.stringify(e))):"刪除優惠券"===t?(this.bsModal=(0,k.$7)("deleteModal"),this.modal.temp=e):"建立新優惠券"===t&&(this.bsModal=(0,k.$7)("couponModal"),this.modal.temp={}),this.bsModal.show()},openSuccessModal(){this.$emitter.emit("page-loading",!1),this.bsModal=(0,k.$7)("SuccessModal"),this.bsModal.show()},clearTemp(){this.modal.temp={}},toDate(t){const e=new Date(1e3*t);return e.toLocaleDateString()}}};const gt=(0,ut.Z)(_t,[["render",y]]);var ft=gt}}]);
//# sourceMappingURL=433.0010ced0.js.map